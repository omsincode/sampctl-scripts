================================================================================
                         PAWN CODING REFERENCE GUIDE
                           SA-MP Server - Star Town
================================================================================

1. INCLUDE SYSTEM & DEPENDENCIES
??????????????????????????????????????????????????????????????????????????????
#include <a_samp>      // SA-MP API
#include <a_mysql>     // MySQL Plugin (R41-4)
#include <zcmd>        // Command Processor

? NO sscanf2 - ใช้ SplitParams() ที่สร้างเอง

Include Order (main.pwn):
    1. scripts/database.pwn
    2. scripts/player_data.pwn
    3. scripts/login_systems.pwn
    4. scripts/save_systems.pwn
    5. scripts/loads_systems.pwn
    6. scripts/inventory_systems.pwn
    7. scripts/ability_items.pwn       // ต้อง include หลัง inventory
    8. scripts/ondialogresponse.pwn
    9. scripts/commands/admin_commands.pwn

Include Guard (ทุกไฟล์):
    #if defined _filename_included
        #endinput
    #endif
    #define _filename_included

2. GLOBAL VARIABLES (สำคัญ)
??????????????????????????????????????????????????????????????????????????????
new g_AutoSaveTimer = -1;                       // Auto-save timer
new MySQL:dbHandle = MYSQL_INVALID_HANDLE;      // MySQL connection
static bool:g_DBReady = false;                  // Connection status
new ItemData[MAX_ITEMS][E_ITEM_DATA];           // Item cache
new g_TotalItems = 0;                           // Item count
new LastSaveTick[MAX_PLAYERS];                  // Save throttle
new PlayerInventory[MAX_PLAYERS][MAX_PLAYER_ITEMS][E_PLAYER_INVENTORY];
new PlayerInventoryCount[MAX_PLAYERS];          // Inventory count per player

#define DIALOG_LOGIN        1
#define DIALOG_REGISTER     2
#define DIALOG_ADMIN_HELP   101
#define DIALOG_INVENTORY    200                 // Inventory dialog
#define DIALOG_ITEM_INFO    201                 // Item detail dialog

3. PLAYER DATA STRUCTURES (Enums)
??????????????????????????????????????????????????????????????????????????????
enum E_PLAYER_INT_DATA {
    PlayerID, AdminLevel, Skin, Money, Health, Armour, Level, XP, Gang, LoginAttempts
};
new PlayerIntData[MAX_PLAYERS][E_PLAYER_INT_DATA];

enum E_PLAYER_FLOAT_DATA {
    FLOAT:LastPosX, FLOAT:LastPosY, FLOAT:LastPosZ, FLOAT:LastAngle
};
new FLOAT:PlayerFloatData[MAX_PLAYERS][E_PLAYER_FLOAT_DATA];

enum E_PLAYER_BOOL_DATA {
    bool:IsLoggedIn, bool:DataReady, bool:NewAccount, bool:Spawned
};
new PlayerBoolData[MAX_PLAYERS][E_PLAYER_BOOL_DATA];

enum E_ITEM_DATA {
    ItemDBID, ItemName[MAX_ITEM_NAME], ItemDescription[MAX_ITEM_DESC], Float:ItemWeight, E_ITEM_TYPE:ItemType
};

enum E_ITEM_TYPE {
    ITEM_TYPE_NONE = 0,     // ไอเท็มทั่วไป
    ITEM_TYPE_FOOD,         // อาหาร (+10 HP)
    ITEM_TYPE_DRINK,        // เครื่องดื่ม (+15 HP)
    ITEM_TYPE_MEDICAL,      // ยา (+30 HP)
    ITEM_TYPE_ARMOR,        // เกราะ (+100 Armour)
    ITEM_TYPE_WEAPON,       // อาวุธ (ให้อาวุธ)
    ITEM_TYPE_TOOL          // เครื่องมือ (ซ่อมรถ)
};

enum E_PLAYER_INVENTORY {
    InvItemID, InvQuantity, InvInventoryID
};

4. MACRO DEFINITIONS (State Checkers)
??????????????????????????????????????????????????????????????????????????????
#define IsPlayerLoggedIn(%0)    (PlayerBoolData[%0][IsLoggedIn])
#define IsPlayerDataReady(%0)   (PlayerBoolData[%0][DataReady])
#define IsPlayerNewAccount(%0)  (PlayerBoolData[%0][NewAccount])
#define HasPlayerSpawned(%0)    (PlayerBoolData[%0][Spawned])

#define PRESSED(%0) \
    (((newkeys & (%0)) == (%0)) && ((oldkeys & (%0)) != (%0)))

Key Constants:
    KEY_YES = Y หรือ ~ (เปิด Inventory)

5. CUSTOM FUNCTIONS (สร้างเอง)
??????????????????????????????????????????????????????????????????????????????
stock SplitParams(const string[], args[][32], maxArgs = sizeof(args))
    // แยกพารามิเตอร์แบบ space-separated (แทน sscanf)
    // Returns: จำนวน arguments
    
stock ConnectToDatabase()
    // เชื่อมต่อ MySQL, ตั้ง g_DBReady = true
    
stock SavePlayerData(playerid)
    // Auto-save แบบมี throttle (5 นาที)
    
stock ForceSavePlayerData(playerid)
    // Force save ไม่มี throttle (disconnect/manual)
    
stock LoadPlayerData(playerid)
    // โหลดข้อมูลจาก DB ? Callback: OnPlayerDataLoad
    
stock LoadAllItemsFromDB()
    // โหลดไอเท็มทั้งหมดเข้า ItemData[]

stock DetermineItemType(const itemName[])
    // กำหนดประเภท ability ของไอเท็มจากชื่อ (ability_items.pwn)
    
stock UseItem(playerid, inventorySlot)
    // ใช้งานไอเท็มตาม ability (ability_items.pwn)
    
stock GetItemAbilityText(E_ITEM_TYPE:itemType, dest[], maxlen)
    // ดึงข้อความอธิบาย ability (ability_items.pwn)

stock UseItem(playerid, inventorySlot)
    // ใช้งานไอเท็มตาม ability ของมัน
    // Returns: 1 = สำเร็จ, 0 = ล้มเหลว

stock DetermineItemType(const itemName[])
    // กำหนดประเภทไอเท็มจากชื่อ
    // Returns: E_ITEM_TYPE

stock AddSpawnedVehicle(vehicleid)
    // เพิ่มรถเข้าระบบติดตาม (รถที่เสกจากคำสั่ง)

stock RemoveSpawnedVehicle(vehicleid)
    // ลบรถออกจากระบบติดตาม

stock IsSpawnedVehicle(vehicleid)
    // เช็คว่ารถเป็นรถที่เสกหรือไม่

6. COMMAND SYSTEM (ZCMD)
??????????????????????????????????????????????????????????????????????????????
CMD:vehicle(playerid, params[])
CMD:v(playerid, params[])                       // Short command
CMD:deletevehicle(playerid, params[])
CMD:dv(playerid, params[])
CMD:repair(playerid, params[])
CMD:fix(playerid, params[])
CMD:adminhelp(playerid, params[])
CMD:giveitem(playerid, params[])
CMD:createitem(playerid, params[])              // Create new item (Admin Lv5+)
CMD:inventory(playerid, params[])               // Show inventory dialog
CMD:inv(playerid, params[])                     // Short command
CMD:i(playerid, params[])                       // Shortest command
CMD:reloaditems(playerid, params[])             // Reload items from DB
CMD:itemlist(playerid, params[])                // Show all items list
CMD:clearspawnedvehicles(playerid, params[])    // Clear spawned vehicles (Admin Lv2+)
CMD:clearveh(playerid, params[])                // Short command
CMD:cveh(playerid, params[])                    // Shortest command

Hotkey:
    กดปุ่ม Y หรือ ~ ? เปิด Inventory Dialog (ต้องล็อกอินก่อน)

Permission Check:
    if (PlayerIntData[playerid][AdminLevel] < 1) {
        return SendClientMessage(playerid, COLOR_RED, "No permission!");
    }

Parse Parameters:
    new args[3][32];
    new count = SplitParams(params, args);
    new vehicleid = strval(args[0]);

7. DATABASE PATTERNS
??????????????????????????????????????????????????????????????????????????????
// Async Query
mysql_tquery(dbHandle, query, "OnCallback", "i", playerid);

// Prepared Statement (ป้องกัน SQL Injection)
mysql_format(dbHandle, query, sizeof(query), 
    "SELECT * FROM players WHERE player_name = '%e'", playername);

8. IMPORTANT CALLBACKS
??????????????????????????????????????????????????????????????????????????????
public OnGameModeInit()
    ? ConnectToDatabase()
    ? LoadAllItemsFromDB()
    ? SetTimer("AutoSaveTick", 300000, true)

public AutoSaveTick()
    ? วนลูป MAX_PLAYERS
    ? SavePlayerData(i) สำหรับผู้เล่นที่ล็อกอิน

public OnPlayerDisconnect(playerid, reason)
    ? ForceSavePlayerData(playerid)
    ? ResetPlayerData(playerid)

public OnPlayerKeyStateChange(playerid, newkeys, oldkeys)
    ? กดปุ่ม KEY_YES (Y หรือ ~) ? เปิด Inventory Dialog
    ? ต้องล็อกอินก่อนใช้งาน

public OnDialogResponse(playerid, dialogid, response, listitem, inputtext[])
    ? DIALOG_LOGIN / DIALOG_REGISTER
    ? DIALOG_ADMIN_HELP
    ? DIALOG_INVENTORY (แสดงรายการไอเท็ม)
    ? DIALOG_ITEM_INFO (แสดงรายละเอียด + ปุ่ม "ใช้" และ "ปิด")

9. NAMING CONVENTION
??????????????????????????????????????????????????????????????????????????????
Functions:      PascalCase          (LoadPlayerData, ShowLoginDialog)
Variables:      camelCase           (dbHandle, g_AutoSaveTimer)
Enums:          E_UPPER_CASE        (E_PLAYER_INT_DATA)
Defines:        UPPER_CASE          (MAX_ITEMS, COLOR_RED)
Macros:         PascalCase          (IsPlayerLoggedIn)

10. KEY SYNTAX RULES
??????????????????????????????????????????????????????????????????????????????
? ใช้ FLOAT: tag สำหรับ float ใน array
? Cast ชัดเจน: float(x), floatround(f)
? Comment เป็นภาษาไทย
? Section headers: // ---------- Name ----------

================================================================================
                           Created by: omsincode
================================================================================
